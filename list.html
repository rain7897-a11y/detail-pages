<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>제품 상세페이지 목록</title>

<style>
body{font-family:system-ui;margin:0;background:#f5f6f8}
.wrap{max-width:900px;margin:40px auto;background:#fff;padding:30px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
h1{margin:0}
.top{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:14px}
.count{font-size:14px;color:#666}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0 18px}
input,select{padding:9px 12px;border-radius:10px;border:1px solid #ddd;background:#fff}
.item{padding:14px 0;border-bottom:1px solid #eee}
.item a{text-decoration:none;font-weight:600;color:#0a58ca}
.item a:hover{text-decoration:underline}
.meta{font-size:12px;color:#777;margin-top:6px}
.badge{display:inline-block;font-size:12px;color:#111;background:#f2f3f5;border:1px solid #e5e7eb;padding:2px 8px;border-radius:999px;margin-right:8px}
</style>
</head>

<body>
<div class="wrap">

  <div class="top">
    <h1>제품 목록</h1>
    <div class="count" id="count">불러오는 중...</div>
  </div>

  <div class="controls">
    <input type="text" id="search" placeholder="제품 검색 (파일명 기준)">
    <select id="sort">
      <option value="latest" selected>최신순(코드/SKU 내림차순)</option>
      <option value="az">이름순(A→Z)</option>
      <option value="za">이름순(Z→A)</option>
    </select>
  </div>

  <div id="list"></div>

</div>

<script>
/* 설정 */
const BASE = "https://detail-pages.pages.dev/";
const API  = "https://api.github.com/repos/rain7897-a11y/detail-pages/contents/";

/* 파일명에서 선행 숫자(SKU/코드) 추출: 3436956_... -> 3436956 */
function getLeadingNumber(filename){
  const m = filename.match(/^(\d{3,})[_-]/); // 3자리 이상 숫자 + _ 또는 -
  return m ? parseInt(m[1], 10) : null;
}

function displayName(filename){
  return filename.replace(".html","").replaceAll("_"," ");
}

let allHtml = [];

fetch(API)
  .then(r=>r.json())
  .then(files=>{
    allHtml = files.filter(f => f.name && f.name.endsWith(".html"));
    document.getElementById("count").innerText = "총 " + allHtml.length + "개";
    applyAndRender();
  })
  .catch(err=>{
    document.getElementById("count").innerText = "목록 불러오기 실패";
    console.error(err);
  });

document.getElementById("search").addEventListener("input", applyAndRender);
document.getElementById("sort").addEventListener("change", applyAndRender);

function applyAndRender(){
  const q = (document.getElementById("search").value || "").toLowerCase().trim();
  const sortMode = document.getElementById("sort").value;

  let list = allHtml.slice();

  // 검색(파일명 기준)
  if(q){
    list = list.filter(f => f.name.toLowerCase().includes(q));
  }

  // 정렬
  if(sortMode === "latest"){
    // 1순위: 선행 숫자(SKU) 내림차순, 2순위: 파일명 내림차순
    list.sort((a,b)=>{
      const an = getLeadingNumber(a.name);
      const bn = getLeadingNumber(b.name);
      if(an !== null && bn !== null) return bn - an;
      if(an !== null) return -1;
      if(bn !== null) return 1;
      return b.name.localeCompare(a.name, "ko");
    });
  } else if(sortMode === "az"){
    list.sort((a,b)=> displayName(a.name).localeCompare(displayName(b.name), "ko"));
  } else if(sortMode === "za"){
    list.sort((a,b)=> displayName(b.name).localeCompare(displayName(a.name), "ko"));
  }

  render(list);
}

function render(list){
  const box = document.getElementById("list");
  box.innerHTML = "";

  list.forEach(f=>{
    const sku = getLeadingNumber(f.name);
    const name = displayName(f.name);

    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <a href="${BASE + encodeURIComponent(f.name)}" target="_blank" rel="noopener">
        ${name}
      </a>
      <div class="meta">
        ${sku !== null ? `<span class="badge">코드 ${sku}</span>` : ``}
        <span>${f.name}</span>
      </div>
    `;
    box.appendChild(div);
  });

  // 검색 결과 수 표시
  document.getElementById("count").innerText = "표시 " + list.length + "개 / 총 " + allHtml.length + "개";
}
</script>

</body>
</html>
